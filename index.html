<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>To‑Do</title>
<style>
  :root{
    --bg:#f7f8fb; --card:#ffffff; --text:#0f172a; --muted:#94a3b8;
    --line:#e8ecf1; --accent:#0ea5e9; --green:#16a34a; --danger:#ef4444;
    --day-radius:12px; --day-gap:6px; --day-pad:6px;
  }
  *{box-sizing:border-box}
  body{ margin:0; background:var(--bg); color:var(--text);
        font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
  .app{ max-width:720px; margin:0 auto; padding:16px 12px 28px; }
  .title{ font-weight:800; font-size:18px; margin:0 0 10px 2px; }

  /* Календарь */
  .cal{ background:var(--card); border:1px solid var(--line); border-radius:16px; padding:6px; margin-bottom:14px; }
  .cal-viewport{
    overflow-x:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch; display:flex; gap:0;
    scrollbar-width:none; -ms-overflow-style:none;
  }
  .cal-viewport::-webkit-scrollbar{ display:none; }
  .week{ flex:0 0 100%; display:grid; grid-template-columns:repeat(7,1fr); gap:var(--day-gap); padding:4px; scroll-snap-align:start; }
  .day{ background:#fff; border:1px solid var(--line); border-radius:var(--day-radius); padding:var(--day-pad) 4px; text-align:center; cursor:pointer; user-select:none; }
  .dow{ font-size:10px; color:var(--muted); line-height:1; }
  .dnum{ font-weight:700; font-size:14px; line-height:1.2; }
  .day.today{ outline:2px solid rgba(14,165,233,.25); }
  .day.selected{ background:rgba(14,165,233,.1); border-color:rgba(14,165,233,.4); }

  /* Добавление */
  .add{ display:flex; gap:8px; margin:12px 0; background:var(--card); border:1px solid var(--line); border-radius:16px; padding:10px; align-items:stretch; }
  .add input[type=text]{ flex:1; min-width:0; padding:12px; border:1px solid var(--line); background:#fff; border-radius:12px; outline:none; }
  .add select{ width:160px; flex:0 0 auto; padding:12px; border:1px solid var(--line); background:#fff; border-radius:12px; outline:none; }
  .add button{ padding:12px 14px; border:0; background:var(--accent); color:#fff; border-radius:12px; cursor:pointer; }

  /* Списки */
  .card{ background:var(--card); border:1px solid var(--line); border-radius:16px; padding:6px 6px 10px; }
  .section-title{ font-weight:800; font-size:16px; margin:10px 8px 6px; }
  ul{ list-style:none; padding:0; margin:0; }
  li{ display:flex; align-items:center; gap:10px; background:#fff; border:1px solid var(--line);
      border-radius:14px; padding:10px; margin:8px 6px; transition:box-shadow .15s, transform .15s; }
  li:hover{ box-shadow:0 6px 16px rgba(2,6,23,.08); transform:translateY(-1px); }
  .item{ display:flex; align-items:center; gap:10px; flex:1; }

  /* круглые чекбоксы */
  .chk{ appearance:none; -webkit-appearance:none; width:22px; height:22px; border-radius:50%;
        border:2px solid var(--line); background:#fff; cursor:pointer; display:inline-block; }
  .chk:checked{
    border-color:var(--green); background-color:var(--green);
    background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path fill="white" d="M8.143 13.314L4.7 9.871l-1.4 1.4 4.843 4.843 8.514-8.514-1.4-1.4z"/></svg>');
    background-repeat:no-repeat; background-position:center; background-size:14px 14px;
  }

  .text{ flex:1; word-break:break-word; }

  /* Стили приоритетов (для активных задач) */
  li[data-prio="super"]   .text{ font-weight:800; }
  li[data-prio="important"] .text{ text-decoration: underline; text-decoration-thickness: 2px; text-underline-offset: 3px; }
  li[data-prio="maybe"]   .text::after{ content:" ?"; color:var(--accent); font-weight:700; }

  /* Выполненные — всегда зачёркнутые/тусклые, поверх приоритета */
  li.completed .text{ color:var(--muted); opacity:.6; text-decoration:line-through !important; text-decoration-thickness:2px; }

  .del{ border:1px solid var(--line); background:#fff; color:#d00; width:34px; height:34px; border-radius:10px; cursor:pointer; }
  .hint{ color:var(--muted); font-size:12px; margin:8px 10px; }
</style>
</head>
<body>
  <div class="app">
    <h2 class="title">To‑Do list</h2>

    <!-- Календарь -->
    <div class="cal">
      <div class="cal-viewport" id="calViewport"></div>
    </div>

    <!-- Добавление -->
    <div class="add">
      <input id="taskInput" type="text" placeholder="Новая задача…" />
      <select id="prioSelect" title="Приоритет">
        <option value="normal" selected>Обычные</option>
        <option value="important">Важные</option>
        <option value="super">Супер важные</option>
        <option value="maybe">Подумать над выполнением</option>
      </select>
      <button id="addBtn">Добавить</button>
    </div>

    <!-- Активные -->
    <div class="card">
      <ul id="activeList"></ul>
      <div class="hint">Выбирай день сверху. Свайпай календарь влево/вправо для соседних недель.</div>
    </div>

    <!-- Completed -->
    <div class="card" style="margin-top:14px;">
      <div class="section-title">Completed</div>
      <ul id="doneList"></ul>
    </div>
  </div>

<script>
const $ = s => document.querySelector(s);

/* ---------- state ---------- */
let state = JSON.parse(localStorage.getItem("todo-v7") || '{"selected":"","days":{}}');
const save = () => localStorage.setItem("todo-v7", JSON.stringify(state));
const isoDate = d => { const x=new Date(d); x.setHours(0,0,0,0); return x.toISOString().slice(0,10); };
const todayISO = () => isoDate(new Date());
if(!state.selected) { state.selected = todayISO(); save(); }

/* ---------- calendar ---------- */
const vp = $("#calViewport");
const DOW = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
const startOfWeek = d => { const dt=new Date(d); const day=(dt.getDay()+6)%7; dt.setDate(dt.getDate()-day); dt.setHours(0,0,0,0); return dt; };
const addDays = (d,n) => { const x=new Date(d); x.setDate(x.getDate()+n); return x; };

let anchor = new Date(state.selected);
function renderWeeks() {
  vp.innerHTML = "";
  const base = startOfWeek(anchor);
  const pages = 12, center = Math.floor(pages/2);

  for(let w=0; w<pages; w++){
    const weekStart = addDays(base, (w-center)*7);
    const week = document.createElement("div"); week.className = "week";

    for(let i=0;i<7;i++){
      const d = addDays(weekStart,i);
      const id = isoDate(d);

      const el = document.createElement("div");
      el.className = "day";
      if(id === todayISO()) el.classList.add("today");
      if(id === state.selected) el.classList.add("selected");

      const dow = document.createElement("div"); dow.className="dow"; dow.textContent = DOW[i];
      const num = document.createElement("div"); num.className="dnum"; num.textContent = d.getDate();
      el.appendChild(dow); el.appendChild(num);

      el.addEventListener("click", () => { state.selected=id; anchor=d; save(); renderWeeks(); renderTasks(); });
      week.appendChild(el);
    }
    vp.appendChild(week);
  }
  const currentWeek = vp.children[center];
  if(currentWeek) currentWeek.scrollIntoView({behavior:"auto", inline:"start"});
}
renderWeeks();

/* ---------- tasks ---------- */
const activeList = $("#activeList");
const doneList   = $("#doneList");
const input      = $("#taskInput");
const prioSel    = $("#prioSelect");
const addBtn     = $("#addBtn");

const prioOrder = { super:0, important:1, normal:2, maybe:3 };

function tasksForSelected(){
  const key = state.selected;
  if(!state.days[key]) state.days[key] = [];
  return state.days[key];
}
function addTask(){
  const text = input.value.trim();
  if(!text) return;
  tasksForSelected().push({ text, prio: prioSel.value, done:false, created:Date.now() });
  input.value = ""; prioSel.value = "normal";
  save(); renderTasks();
}
addBtn.addEventListener("click", addTask);
input.addEventListener("keypress", e => { if(e.key==="Enter") addTask(); });

function toggleTask(i){
  const t = tasksForSelected(); t[i].done=!t[i].done; save(); renderTasks();
}
function delTask(i){
  const t = tasksForSelected(); t.splice(i,1); save(); renderTasks();
}

function renderTasks(){
  const tasks = tasksForSelected();
  const active = tasks.filter(t=>!t.done).sort((a,b)=> prioOrder[a.prio]-prioOrder[b.prio] || a.created-b.created);
  const done   = tasks.filter(t=> t.done).sort((a,b)=> a.created-b.created);

  const renderList = (arr, target, completed=false) => {
    target.innerHTML = "";
    arr.forEach(task=>{
      const idx = tasks.indexOf(task);
      const li  = document.createElement("li");
      if(completed) li.classList.add("completed");
      li.setAttribute("data-prio", task.prio);

      const label = document.createElement("label"); label.className = "item";

      const cb = document.createElement("input");
      cb.type="checkbox"; cb.className="chk"; cb.checked=completed;
      cb.addEventListener("change",()=>toggleTask(idx));

      const text = document.createElement("span");
      text.className="text"; text.textContent=task.text;
      text.addEventListener("click",()=>toggleTask(idx));

      label.appendChild(cb);
      label.appendChild(text);

      const del = document.createElement("button");
      del.className="del"; del.textContent="×"; del.title="Удалить";
      del.addEventListener("click",()=>delTask(idx));

      li.appendChild(label); li.appendChild(del);
      target.appendChild(li);
    });
  };

  renderList(active, activeList, false);
  renderList(done, doneList, true);

  state.days[state.selected] = [...active, ...done];
  save();
}
renderTasks();
</script>
</body>
</html>
