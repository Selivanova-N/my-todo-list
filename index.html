<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>To‑Do</title>
<style>
  :root{
    --bg:#f7f8fb; --card:#ffffff; --text:#0f172a; --muted:#94a3b8;
    --line:#e8ecf1; --accent:#0ea5e9; --green:#22c55e; --danger:#ef4444;
    --hi:#ef4444; --mid:#f59e0b; --low:#22c55e; --none:#cbd5e1;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  .app{ max-width:720px; margin:0 auto; padding:16px 12px 28px; }

  /* top row */
  .top{ display:flex; align-items:center; gap:12px; margin-bottom:10px; }
  .burger{ width:40px; height:40px; border-radius:12px; border:1px solid var(--line); background:#fff; }
  .title{ font-weight:800; font-size:20px; }
  .icons{ margin-left:auto; display:flex; gap:8px; }
  .icon{ width:40px; height:40px; border-radius:12px; border:1px solid var(--line); background:#fff; }

  /* calendar */
  .cal{
    background:var(--card); border:1px solid var(--line); border-radius:16px;
    padding:10px; display:flex; align-items:center; gap:8px; margin-bottom:14px;
  }
  .cal-btn{
    width:36px; height:36px; border-radius:10px; border:1px solid var(--line);
    background:#fff; cursor:pointer;
  }
  .cal-strip{
    overflow-x:auto; display:flex; gap:8px; padding:4px 2px;
    scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch;
  }
  .day{
    min-width:56px; scroll-snap-align:center;
    background:#fff; border:1px solid var(--line); border-radius:14px;
    padding:8px 8px; text-align:center;
  }
  .dow{ font-size:11px; color:var(--muted); }
  .dnum{ font-weight:700; }
  .day.active{ background:rgba(14,165,233,.1); border-color:rgba(14,165,233,.3); }

  /* add */
  .add{
    display:flex; gap:8px; margin:14px 0; background:var(--card); border:1px solid var(--line);
    border-radius:16px; padding:10px;
  }
  .add input[type=text]{
    flex:1; padding:12px; border:1px solid var(--line); background:#fff; border-radius:12px; outline:none;
  }
  .add select{
    padding:12px; border:1px solid var(--line); background:#fff; border-radius:12px; outline:none;
  }
  .add button{
    padding:12px 14px; border:0; background:var(--accent); color:#fff; border-radius:12px; cursor:pointer;
  }

  /* lists */
  .card{
    background:var(--card); border:1px solid var(--line); border-radius:16px; padding:6px 6px 10px;
  }
  .section-title{ font-weight:800; font-size:16px; margin:10px 8px 6px; }

  ul{ list-style:none; padding:0; margin:0; }
  li{
    display:flex; align-items:center; gap:10px; background:#fff; border:1px solid var(--line);
    border-radius:14px; padding:10px; margin:8px 6px; transition:box-shadow .15s ease, transform .15s ease;
  }
  li:hover{ box-shadow:0 6px 16px rgba(2,6,23,.08); transform:translateY(-1px); }
  .item{ display:flex; align-items:center; gap:10px; flex:1; }
  .item input[type=checkbox]{ width:22px; height:22px; border-radius:50%; accent-color:var(--green); cursor:pointer; }
  .text{ flex:1; word-break:break-word; }
  li.completed .text{ color:var(--muted); opacity:.6; text-decoration:line-through; text-decoration-thickness:2px; }
  .prio{
    width:10px; height:10px; border-radius:50%;
    box-shadow:0 0 0 2px #fff inset, 0 0 0 2px var(--line);
  }
  .p-hi{ background:var(--hi) }
  .p-mid{ background:var(--mid) }
  .p-low{ background:var(--low) }
  .p-none{ background:var(--none) }
  .del{
    border:1px solid var(--line); background:#fff; color:#d00; width:34px; height:34px; border-radius:10px; cursor:pointer;
  }
  .hint{ color:var(--muted); font-size:12px; margin:8px 10px; }
</style>
</head>
<body>
  <div class="app">
    <div class="top">
      <button class="burger" aria-label="menu"></button>
      <div class="title">To‑Do list</div>
      <div class="icons">
        <button class="icon" aria-label="calendar"></button>
        <button class="icon" aria-label="more"></button>
      </div>
    </div>

    <!-- Календарь: горизонтальная лента -->
    <div class="cal">
      <button class="cal-btn" id="prevWeek" aria-label="prev">←</button>
      <div class="cal-strip" id="calStrip"></div>
      <button class="cal-btn" id="nextWeek" aria-label="next">→</button>
    </div>

    <!-- Добавление задачи -->
    <div class="add">
      <input id="taskInput" type="text" placeholder="Новая задача…" />
      <select id="prioSelect" title="Приоритет">
        <option value="none">None</option>
        <option value="low">Low</option>
        <option value="mid">Medium</option>
        <option value="hi">High</option>
      </select>
      <button id="addBtn">Добавить</button>
    </div>

    <!-- Активные задачи -->
    <div class="card">
      <ul id="activeList"></ul>
      <div class="hint">Клик по флажку или тексту — отметить/снять. Выполненные автоматически окажутся ниже, в «Completed».</div>
    </div>

    <!-- Completed -->
    <div class="card" style="margin-top:14px;">
      <div class="section-title">Completed</div>
      <ul id="doneList"></ul>
    </div>
  </div>

<script>
const $ = s => document.querySelector(s);
const activeList = $("#activeList");
const doneList   = $("#doneList");
const input      = $("#taskInput");
const prioSel    = $("#prioSelect");
const addBtn     = $("#addBtn");

let state = JSON.parse(localStorage.getItem("todo-v3") || '{"tasks":[]}');

function save(){ localStorage.setItem("todo-v3", JSON.stringify(state)); }

/* ---------- Calendar strip ---------- */
const calStrip = $("#calStrip");
let weekOffset = 0; // 0 = текущая неделя, -1 предыдущая, +1 следующая
const DOW = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];

function startOfWeek(d){
  const dt = new Date(d);
  const day = (dt.getDay()+6)%7; // 0=Mon
  dt.setDate(dt.getDate()-day);
  dt.setHours(0,0,0,0);
  return dt;
}
function addDays(d,n){ const x=new Date(d); x.setDate(x.getDate()+n); return x; }
function renderWeek(){
  calStrip.innerHTML = "";
  const today = new Date();
  const start = addDays(startOfWeek(today), weekOffset*7);

  for(let i=0;i<7;i++){
    const d = addDays(start,i);
    const el = document.createElement("div");
    el.className = "day";
    if(d.toDateString() === today.toDateString()) el.classList.add("active");
    const dow = document.createElement("div"); dow.className="dow"; dow.textContent = DOW[i];
    const num = document.createElement("div"); num.className="dnum"; num.textContent = d.getDate();
    el.appendChild(dow); el.appendChild(num);
    calStrip.appendChild(el);
  }
}
$("#prevWeek").addEventListener("click", ()=>{ weekOffset--; renderWeek(); });
$("#nextWeek").addEventListener("click", ()=>{ weekOffset++; renderWeek(); });
renderWeek();

/* ---------- Tasks ---------- */
function addTask(){
  const text = input.value.trim();
  if(!text) return;
  const prio = prioSel.value; // hi, mid, low, none
  state.tasks.push({ text, prio, done:false, created:Date.now() });
  input.value = ""; prioSel.value = "none";
  render(); save();
}
addBtn.addEventListener("click", addTask);
input.addEventListener("keypress", e => { if(e.key==="Enter") addTask(); });

function toggleTask(idx){
  state.tasks[idx].done = !state.tasks[idx].done;
  render(); save();
}
function delTask(idx){
  state.tasks.splice(idx,1);
  render(); save();
}

const prioOrder = { hi:0, mid:1, low:2, none:3 };
function render(){
  const active = state.tasks.filter(t=>!t.done)
    .sort((a,b)=> prioOrder[a.prio]-prioOrder[b.prio] || a.created-b.created);
  const done   = state.tasks.filter(t=>t.done)
    .sort((a,b)=> a.created-b.created);

  // Визуал активных
  activeList.innerHTML = "";
  active.forEach(task=>{
    const idx = state.tasks.indexOf(task);
    const li  = document.createElement("li");

    const label = document.createElement("label");
    label.className = "item";

    const cb = document.createElement("input");
    cb.type = "checkbox"; cb.checked = false;
    cb.addEventListener("change", ()=>toggleTask(idx));

    const dot = document.createElement("span");
    dot.className = "prio p-"+task.prio;

    const text = document.createElement("span");
    text.className = "text"; text.textContent = task.text;
    text.addEventListener("click", ()=>toggleTask(idx));

    label.appendChild(cb); label.appendChild(dot); label.appendChild(text);

    const del = document.createElement("button");
    del.className = "del"; del.textContent = "×"; del.title = "Удалить";
    del.addEventListener("click", ()=>delTask(idx));

    li.appendChild(label); li.appendChild(del);
    activeList.appendChild(li);
  });

  // Визуал завершённых
  doneList.innerHTML = "";
  done.forEach(task=>{
    const idx = state.tasks.indexOf(task);
    const li  = document.createElement("li");
    li.classList.add("completed");

    const label = document.createElement("label");
    label.className = "item";

    const cb = document.createElement("input");
    cb.type = "checkbox"; cb.checked = true;
    cb.addEventListener("change", ()=>toggleTask(idx));

    const dot = document.createElement("span");
    dot.className = "prio p-"+task.prio;

    const text = document.createElement("span");
    text.className = "text"; text.textContent = task.text;
    text.addEventListener("click", ()=>toggleTask(idx));

    label.appendChild(cb); label.appendChild(dot); label.appendChild(text);

    const del = document.createElement("button");
    del.className = "del"; del.textContent = "×"; del.title = "Удалить";
    del.addEventListener("click", ()=>delTask(idx));

    li.appendChild(label); li.appendChild(del);
    doneList.appendChild(li);
  });

  // пересохраняем порядок (активные сверху, завершённые снизу)
  state.tasks = [...active, ...done];
  save();
}
render();
</script>
</body>
</html>
